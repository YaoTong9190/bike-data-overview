<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<style>
h1,
h2,
h3,
h4,
h5,
h6,
p,
blockquote {
    margin: 0;
    padding: 0;
}
body {
    font-family: "Helvetica Neue", Helvetica, "Hiragino Sans GB", Arial, sans-serif;
    font-size: 13px;
    line-height: 18px;
    color: #737373;
    background-color: white;
    margin: 10px 13px 10px 13px;
}
table {
	margin: 10px 0 15px 0;
	border-collapse: collapse;
}
td,th {	
	border: 1px solid #ddd;
	padding: 3px 10px;
}
th {
	padding: 5px 10px;	
}

a {
    color: #0069d6;
}
a:hover {
    color: #0050a3;
    text-decoration: none;
}
a img {
    border: none;
}
p {
    margin-bottom: 9px;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    color: #404040;
    line-height: 36px;
}
h1 {
    margin-bottom: 18px;
    font-size: 30px;
}
h2 {
    font-size: 24px;
}
h3 {
    font-size: 18px;
}
h4 {
    font-size: 16px;
}
h5 {
    font-size: 14px;
}
h6 {
    font-size: 13px;
}
hr {
    margin: 0 0 19px;
    border: 0;
    border-bottom: 1px solid #ccc;
}
blockquote {
    padding: 13px 13px 21px 15px;
    margin-bottom: 18px;
    font-family:georgia,serif;
    font-style: italic;
}
blockquote:before {
    content:"\201C";
    font-size:40px;
    margin-left:-10px;
    font-family:georgia,serif;
    color:#eee;
}
blockquote p {
    font-size: 14px;
    font-weight: 300;
    line-height: 18px;
    margin-bottom: 0;
    font-style: italic;
}
code, pre {
    font-family: Monaco, Andale Mono, Courier New, monospace;
}
code {
    background-color: #fee9cc;
    color: rgba(0, 0, 0, 0.75);
    padding: 1px 3px;
    font-size: 12px;
    -webkit-border-radius: 3px;
    -moz-border-radius: 3px;
    border-radius: 3px;
}
pre {
    display: block;
    padding: 14px;
    margin: 0 0 18px;
    line-height: 16px;
    font-size: 11px;
    border: 1px solid #d9d9d9;
    white-space: pre-wrap;
    word-wrap: break-word;
}
pre code {
    background-color: #fff;
    color:#737373;
    font-size: 11px;
    padding: 0;
}
sup {
    font-size: 0.83em;
    vertical-align: super;
    line-height: 0;
}
* {
	-webkit-print-color-adjust: exact;
}
@media screen and (min-width: 914px) {
    body {
        width: 854px;
        margin:10px auto;
    }
}
@media print {
	body,code,pre code,h1,h2,h3,h4,h5,h6 {
		color: black;
	}
	table, pre {
		page-break-inside: avoid;
	}
}
</style>
<title>Week 4 Exercises</title>

</head>
<body>
<h1>Week 4 Exercises</h1>

<h2>Before you start</h2>

<p>Decide where you are going to store your work, i.e., any data sets that you download and modify, any scripts you might write or use, any other outputs that you create from the data. Options (not mutually exclusive) include:</p>

<ul>
<li>a standard folder on local storage on your laptop</li>
<li>in the cloud; e.g. Dropbox or Google Drive folder</li>
<li>in a versioned repository, such as git + GitHub</li>
</ul>


<p>Name your work folders clearly and create subfolders if necessary. Do you care if you lose the folder?</p>

<h2>Finding Data</h2>

<p>Data stores to use:</p>

<ul>
<li>City of Edinburgh Council (CEC) <a href="http://www.edinburghopendata.info/dataset">Open Data Store</a></li>
<li>CEC <a href="https://github.com/edinburghcouncil/datasets">GitHub repository</a></li>
</ul>


<p>And possibly</p>

<ul>
<li><a href="http://www.sns.gov.uk/default.aspx">Scottish Neighbourhood Statistics</a></li>
</ul>


<h3>Tasks</h3>

<p>Try to use data from the <strong>CEC data sets</strong> to answer the following questions <strong>about Inverleith</strong>.</p>

<ol>
<li>How many allotments are there?</li>
<li>How many leisure centres are there?</li>
<li>How many museums and art galleries?</li>
<li>How many public bike parking facilities?</li>
<li>Find out something interesting about Inverleith not already on this list.</li>
</ol>


<p>You may be able to do this by identifying relevant data sets in the CEC data stores and just looking at the data.</p>

<p>You may find that some of the data is geocoded using <a href="http://en.wikipedia.org/wiki/World_Geodetic_System">WGS84 latitude and longitude</a> coordinates; e.g., <code>55.954419, -3.1735552</code>. If you just paste these coordinates into a Google search bar, it will return a little map of the location.</p>

<h2>Organising Tabular Data</h2>

<h3>First steps</h3>

<ol>
<li>Download the <code>Cepats 2013.xls</code> file from <a href="https://github.com/edinburghlivinglab/cyclehack/tree/master/CEPATS">CEPATS data</a></li>
<li>Import the file into Google Sheets (or use Libre Office or Excel). Create a new spreadsheet, then do <code>File &gt; Import &gt; Replace spreadsheet</code>.</li>
<li>Make a copy of the file and rename it, just in case you want to rewind to the original version at some point.</li>
<li>We are going to work with only two sheets: <code>IN0730</code> and <code>Survey Information</code>. Let's start with <code>IN0730</code></li>
</ol>


<h3>Working on <code>IN0730</code></h3>

<ol>
<li>First, get clear all formatting.</li>
<li>Next, get rid of all rows except the header rows (i.e., containing the column labels) and the ones starting with 'Abbeyhill' and ending with 'Wester Coates Walkway'.</li>
<li>Get rid of all the columns except:

<ol>
<li>the one with street names</li>
<li>the one headed 'PEDAL CYCLES'</li>
<li>the one headed 'CARS &amp; TAXIS'</li>
</ol>
</li>
<li>There are currently two header rows; collapse these into one</li>
</ol>


<h3>Working on <code>Survey Information</code></h3>

<ol>
<li>Delete all rows apart from the ones with street locations; i.e. 5-43.</li>
<li>Delete all columns apart from the street location one and the one labeled 'O.S. GRID REF.'</li>
<li>Duplicate the 'O.S. GRID REF.' column; e.g. create new column C and copy all of column B to C.</li>
</ol>


<h4>Converting OS Grid Ref to LatLong</h4>

<p>We want to just keep information to the left of the <code>/</code> in column B and just information to the right of the <code>/</code> in column C.</p>

<p>Your goal is to end up with a sheet that looks like this:</p>

<p><img src="images/survey_xy.png" width="500" alt="Locations XY" /></p>

<p>This will allow us to input our Grid Reference XY data into an application that convers the geocoordinates to WGS84 coordinates, which are more widely supported by by mapping coordinates.</p>

<p>We'll use <code>Edit &gt; Find and replace</code> on each column separately, and we'll use regular expressions. These are the settings you should use in Google Sheets:</p>

<h6>Column A</h6>

<p><strong>Find</strong>: <code>/ [0-9]+</code></p>

<p><strong>Replace</strong>: [leave blank]</p>

<p>Check the option: <code>Search using regular expressions</code></p>

<p>Select <code>Specific range</code> and give it the value <code>'Survey Information'!B:B</code></p>

<hr />

<p><em>NB The <strong>replace</strong> string should be empty. Also note that we are deliberately getting rid of the space following the <code>/</code> character. Similarly for the following replacement.</em></p>

<hr />

<h6>Column B</h6>

<p><strong>Find</strong>: <code>[0-9]+ /</code></p>

<p><strong>Replace</strong>: [leave blank]</p>

<p>Check the option: <code>Search using regular expressions</code></p>

<p>Select <code>Specific range</code> and give it the value <code>'Survey Information'!C:C</code></p>

<h4>Looking up LatLong</h4>

<p>We are now going to use the <a href="http://www.gridreferencefinder.com/batchConvert/batchConvert.php">GridReferenceFinder</a>. This requires that you paste your tabular data into a box and tick some options. It should look like this:</p>

<p><img src="images/batchConvert.png" width="500" alt="GridReferenceFinder" /></p>

<p>Paste the results back into a new sheet.</p>

<p>Next, you are are going to add the new data you've just created into <code>IN0730</code>. You want to add this new data as extra columns. The locations in <code>IN0730</code> should align with the street locations that you have just pasted in.</p>

<p>It should look something like this:<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup></p>

<p><img src="images/15mins_geocoded_interim.tiff" width="500" alt="" /></p>

<p>You can now go ahead and delete the column with locations that you pasted in, leaving just the new geo-coordinates. Give labels to these two new columns: <code>Latitude</code> and <code>Longitude</code>, like this:</p>

<p><img src="images/15mins_geocoded.tiff" width="500" alt="" /></p>

<p>Congratulations if you've reached this point successfully!</p>

<h2>Putting the data on a map</h2>

<p>In this section of the exercise, you are going to take a few more steps that will allow you to do a simple visualisation of the data on a map.</p>

<h3>Reorganising the data</h3>

<p>We want to change the spreadsheet so that we have a single column for the number of vehicles, and each row has an extra field for the category of vehicle. Here's what a portion of this would look like:</p>

<p><img src="images/categorised2.tiff" width="500" alt="" /></p>

<p>It is fairly easy to derive this new organisation of the data by copying and pasting in the spreadsheet, so it's up to you exactly how to carry it out. Make sure you save the result with an easy-to-remember name. I'd also recommend that you save it in CSV format.</p>

<h3>Using Google Fusion Tables</h3>

<p>There are several services we could use to map the data set as we now have it. For this exercise, we're going to use  Google <a href="https://support.google.com/fusiontables/answer/2571232?hl=en">Fusion Tables</a>. You will probably have to be logged into a Google account to get access to this service. If the link works for you, you should get to a splash screen that looks like this on Chrome:</p>

<p><img src="images/fusion_splash.tiff" width="500" alt="Fusion splash screen" /></p>

<p>Select the <strong>Create a Fusion Table</strong> button, and in the resulting dialogue box, choose the file that you ended up with in the preceding section. If you saved it in CSV format, all the default settings should work OK.</p>

<p>After loading the file, and choosing the <strong>Map of Latitude</strong> tab, you should get a result that looks like this:</p>

<p><img src="images/fusion_map1.tiff" width="500" alt="Map 1" /></p>

<p>There are a couple of points that immediately strike the eye:</p>

<ol>
<li>there seem to be fewer points that one would expect;</li>
<li>one point in particular seems to be seriously misplaced;</li>
<li>there's no visual distinction between counts of bikes vs. cars.</li>
</ol>


<p>I'm going to ignore (2); if you can figure out the problem with this, let me know! Let's see if we can do something about issue (3).</p>

<p>If you look at the Google <a href="https://support.google.com/fusiontables/answer/2679986?hl=en">tip on changing the icon marker</a>, you'll see some clues on how to differentiate the marker according to the category of vehicle. Rather than adopting the procedure of merging two sheets suggested in the tip, let's just add markers by hand. Here's one examplel of what this might look like:</p>

<p><img src="images/icons.tiff" width="500" alt="icon column" /></p>

<p>I've added a new column (F in this example) and labeled it <strong>Icon</strong>; and I've added the name of markers drawn from this <a href="https://www.google.com/fusiontables/data?docid=1BDnT5U1Spyaes0Nj3DXciJKa_tuu7CzNRXWdVA#map:id=3">guide to Google icon markers</a> -- 'cycling' and 'cabs' are both names for markers. Note also that I've sorted the 'bike' rows on column D, and similarly for the 'car' rows, using an approach like this:</p>

<pre><code>Select column D 1:38

Data &gt; Sort range from D1 to D38

sort by Column D A-&gt;Z
</code></pre>

<p>Reload your data into a Fusion Table, and look at the map. Initially, it will look the same. However, if you go to the <strong>Configure map</strong> settings, and choose <strong>Change feature styles</strong>, you can change the default icon marker by selecting the <strong>Column</strong> option with settings like this:</p>

<p><img src="images/map_features.tiff" width="500" alt="icon column" /></p>

<p>Here's what the result might look like:</p>

<p><img src="images/fusion_map2.tiff" width="500" alt="Map 2" /></p>

<p>This is still not ideal, since the two sets of icons are overlayed. We can mitigate this problem by going to the <strong>Filter</strong> option and filtering on <strong>Category</strong> to only view one category of vehicle at a time.</p>

<p>Here are some more things to do:</p>

<ul>
<li>Use the guidance in <a href="https://support.google.com/fusiontables/answer/2679986?hl=en">tip on changing the icon marker</a> to show different markers for, say, cars, depending on the counts; e.g. a small marker for less than 50 and a big marker for more.</li>
<li>Is there a better way of visualising the data that takes into account that bike and car counts share the same geolocation?</li>
<li>Figure out a way of not showing a marker for zero count data rows.</li>
</ul>


<p><a href="https://support.google.com/fusiontables/answer/2476954?hl=en&amp;topic=2569513&amp;ctx=topic">Alternative Google approach to adding icon markers to an existing sheet</a></p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>Note that I fixed the misspelling of &lsquo;Inverlieth&rsquo;<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

</body>
</html>